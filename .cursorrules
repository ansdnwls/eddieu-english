# Next.js 16 + TypeScript + Firebase Project - Cursor AI Rules

## ğŸ¯ Project Context

You are an expert full-stack developer working on a **Next.js 16 App Router** project for an educational web application that helps children improve their English diary writing with AI-powered corrections.

**Tech Stack:**
- Framework: Next.js 16 (App Router)
- Language: TypeScript (strict mode)
- Styling: Tailwind CSS 4
- Animation: Framer Motion
- Authentication: Firebase Auth
- Database: Firestore
- AI: OpenAI GPT-4
- OCR: Google Vision API

**Target Users:** Children aged 6-13 and their parents
**UI Philosophy:** Child-friendly, warm, encouraging, accessible

---

## ğŸš¨ CRITICAL RULES - MUST FOLLOW

### 1. TypeScript - ZERO TOLERANCE FOR `any`

```typescript
// âœ… ALWAYS DO THIS
interface ImageUploadProps {
  onImageSelect: (file: File) => void;
  selectedImage: File | null;
}

export default function ImageUpload({ 
  onImageSelect, 
  selectedImage 
}: ImageUploadProps) { ... }

// âŒ NEVER DO THIS
function handleData(data: any) { ... }
const result: any = await fetch(...);
```

**RULES:**
- âœ… **MUST** define explicit types for ALL functions, variables, and props
- âœ… **MUST** use `unknown` + type guards if type is truly unknown
- âœ… **MUST** define interfaces in `app/types/index.ts` for shared types
- âœ… **MUST** export reusable types
- âŒ **NEVER** use `any` type (use `unknown` instead)
- âŒ **NEVER** use implicit `any` 
- âŒ **NEVER** disable TypeScript errors with `@ts-ignore`

### 2. Component Architecture - Client vs Server

```typescript
// âœ… CLIENT COMPONENT - Has interactivity
"use client";

import { useState } from "react";
import { motion } from "framer-motion";

export default function InteractiveComponent() {
  const [state, setState] = useState<string>("");
  // ... interactive logic
}

// âœ… SERVER COMPONENT - Static/data fetching
// NO "use client" directive
import { Metadata } from "next";

export const metadata: Metadata = {
  title: "Page Title",
};

export default function StaticPage() {
  return <div>Static content</div>;
}
```

**RULES:**
- âœ… **MUST** use `"use client"` ONLY when component needs:
  - State (`useState`, `useReducer`)
  - Effects (`useEffect`, `useLayoutEffect`)
  - Event handlers (`onClick`, `onChange`)
  - Browser APIs (`window`, `document`)
  - Framer Motion animations
- âœ… **MUST** use Server Components by default
- âœ… **MUST** place `"use client"` at the TOP of the file (first line)
- âŒ **NEVER** add `"use client"` to Server Components
- âŒ **NEVER** use hooks in Server Components

### 3. File Naming - STRICT CONVENTIONS

| File Type | Naming Convention | Example |
|-----------|------------------|---------|
| Pages | `page.tsx` | `app/dashboard/page.tsx` |
| Layouts | `layout.tsx` | `app/admin/layout.tsx` |
| API Routes | `route.ts` | `app/api/correct-diary/route.ts` |
| Components | `PascalCase.tsx` | `ImageUpload.tsx`, `CorrectionResult.tsx` |
| Utils | `camelCase.ts` | `koreanHelper.ts`, `pdfGenerator.ts` |
| Contexts | `PascalCase + Context.tsx` | `AuthContext.tsx` |
| Types | `index.ts` | `app/types/index.ts` |

**RULES:**
- âœ… **MUST** match component name to file name
- âœ… **MUST** use lowercase for route folders
- âŒ **NEVER** use kebab-case for components (use PascalCase)
- âŒ **NEVER** use different casing for file vs component name

### 4. Error Handling - COMPREHENSIVE & USER-FRIENDLY

```typescript
// âœ… ALWAYS DO THIS
const handleSubmit = async () => {
  setIsLoading(true);
  setError(null);
  
  try {
    const response = await fetch("/api/endpoint", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });
    
    const result = await response.json();
    
    if (!result.success) {
      throw new Error(result.error || "Unknown error");
    }
    
    setData(result.data);
  } catch (err: unknown) {
    const error = err as Error;
    console.error("âŒ Error:", error);
    setError(error.message || "An error occurred");
  } finally {
    setIsLoading(false);
  }
};
```

**RULES:**
- âœ… **MUST** wrap ALL async operations in try-catch
- âœ… **MUST** provide user-friendly error messages in Korean
- âœ… **MUST** log detailed errors to console with emojis (âœ…/âŒ/âš ï¸)
- âœ… **MUST** set loading states (before try) and reset them (in finally)
- âœ… **MUST** handle Firebase errors with specific messages
- âŒ **NEVER** swallow errors silently
- âŒ **NEVER** show technical error messages to users
- âŒ **NEVER** forget the `finally` block for cleanup

### 5. API Routes - CONSISTENT STRUCTURE

```typescript
// app/api/example/route.ts
import { NextRequest, NextResponse } from "next/server";

export async function POST(request: NextRequest) {
  try {
    // 1. Parse request
    const body = await request.json();
    const { requiredField } = body;

    // 2. Validate input
    if (!requiredField) {
      return NextResponse.json(
        { success: false, error: "Required field is missing" },
        { status: 400 }
      );
    }

    // 3. Business logic
    const result = await processData(requiredField);

    // 4. Return success
    return NextResponse.json({
      success: true,
      data: result,
    });
  } catch (error: unknown) {
    const err = error as Error;
    console.error("âŒ API Error:", err);
    return NextResponse.json(
      { success: false, error: err.message || "Server error" },
      { status: 500 }
    );
  }
}
```

**RULES:**
- âœ… **MUST** export HTTP methods explicitly (`GET`, `POST`, `PUT`, `DELETE`)
- âœ… **MUST** return consistent response format:
  ```typescript
  { success: boolean; data?: T; error?: string }
  ```
- âœ… **MUST** validate input before processing
- âœ… **MUST** return appropriate HTTP status codes (200, 400, 500)
- âœ… **MUST** provide Mock data fallback when API keys are missing
- âŒ **NEVER** expose sensitive errors to client
- âŒ **NEVER** skip input validation

---

## ğŸ¨ STYLING RULES - TAILWIND CSS

### Class Order Convention (MANDATORY)

```tsx
// âœ… CORRECT ORDER
<div className="
  flex items-center justify-between    // Layout
  w-full max-w-4xl min-h-screen       // Size
  px-4 py-6 gap-4                     // Spacing
  bg-white dark:bg-gray-800           // Background
  text-gray-900 dark:text-white       // Text color
  text-xl font-bold                   // Typography
  rounded-2xl shadow-xl               // Effects
  hover:scale-105 transition-all      // States
">
```

**ORDER:** Layout â†’ Size â†’ Spacing â†’ Background â†’ Text â†’ Typography â†’ Effects â†’ States

### Color System - STRICT PALETTE

```tsx
// Primary Actions
bg-blue-500 hover:bg-blue-600
bg-gradient-to-r from-blue-500 to-purple-500

// Secondary Actions
bg-gray-200 dark:bg-gray-700

// Semantic Colors
bg-green-500  // Success
bg-red-500    // Error/Danger
bg-yellow-500 // Warning
bg-blue-50    // Info

// Background Gradients (Child-friendly)
bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50
dark:from-gray-900 dark:via-purple-900/20 dark:to-pink-900/20
```

**RULES:**
- âœ… **MUST** use Tailwind classes (NO inline styles)
- âœ… **MUST** support dark mode (`dark:` prefix)
- âœ… **MUST** use mobile-first responsive design
- âœ… **MUST** use consistent spacing scale (2, 4, 6, 8, 12)
- âŒ **NEVER** use inline styles (`style={{ ... }}`)
- âŒ **NEVER** create custom CSS unless absolutely necessary
- âŒ **NEVER** use inconsistent colors outside the palette

### Responsive Design - MOBILE FIRST

```tsx
// âœ… ALWAYS mobile-first, then scale up
<div className="
  text-sm sm:text-base md:text-lg lg:text-xl
  grid-cols-1 sm:grid-cols-2 md:grid-cols-3
  px-4 sm:px-6 md:px-8 lg:px-12
">
```

**Breakpoints:**
- `sm: 640px` - Mobile landscape / Small tablet
- `md: 768px` - Tablet
- `lg: 1024px` - Desktop
- `xl: 1280px` - Large desktop

**RULES:**
- âœ… **MUST** start with mobile styles (no prefix)
- âœ… **MUST** progressively enhance for larger screens
- âŒ **NEVER** use desktop-first approach

---

## ğŸ” SECURITY & AUTHENTICATION

### Firebase Integration

```typescript
// âœ… CORRECT - Client-side check
if (typeof window !== "undefined") {
  auth = getAuth(app);
}

// âœ… CORRECT - Environment variable with fallback
const apiKey = process.env.NEXT_PUBLIC_FIREBASE_API_KEY || "fallback-value";

// âœ… CORRECT - Firestore with error handling
try {
  if (!db) {
    throw new Error("Firestore not initialized");
  }
  await setDoc(doc(db, "collection", "docId"), data);
  
  // Backup to localStorage
  localStorage.setItem(`backup_${docId}`, JSON.stringify(data));
} catch (error) {
  console.error("âŒ Firestore error:", error);
  throw error;
}
```

**RULES:**
- âœ… **MUST** check `typeof window !== "undefined"` before using Firebase Auth
- âœ… **MUST** provide fallback values for environment variables
- âœ… **MUST** backup critical data to localStorage
- âœ… **MUST** wrap protected pages with `<AuthGuard>`
- âŒ **NEVER** expose API keys without `NEXT_PUBLIC_` prefix (if server-only)
- âŒ **NEVER** skip client-side checks for Firebase Auth

### Protected Routes

```tsx
// âœ… ALWAYS wrap protected pages
export default function DashboardPage() {
  return (
    <AuthGuard redirectTo="/login">
      {/* Protected content */}
    </AuthGuard>
  );
}
```

**RULES:**
- âœ… **MUST** use `<AuthGuard>` for protected pages
- âœ… **MUST** redirect unauthenticated users to `/login`
- âŒ **NEVER** forget to protect sensitive pages

---

## ğŸ­ ANIMATION RULES - FRAMER MOTION

### Standard Patterns

```tsx
// âœ… Page Entry Animation
<motion.div
  initial={{ opacity: 0, y: 20 }}
  animate={{ opacity: 1, y: 0 }}
  transition={{ duration: 0.5, delay: 0.2 }}
>

// âœ… Button Interaction
<motion.button
  whileHover={{ scale: 1.05 }}
  whileTap={{ scale: 0.98 }}
>

// âœ… Sequential Animation
<motion.div transition={{ delay: 0.1 }} />
<motion.div transition={{ delay: 0.2 }} />
<motion.div transition={{ delay: 0.3 }} />
```

**RULES:**
- âœ… **MUST** use subtle animations (scale: 1.05, not 1.5)
- âœ… **MUST** use consistent duration (0.3-0.5s)
- âœ… **MUST** stagger sequential items with delay
- âŒ **NEVER** use jarring or distracting animations
- âŒ **NEVER** animate on Server Components

---

## ğŸ“Š STATE MANAGEMENT

### Local State - useState

```typescript
// âœ… CORRECT - Local component state
const [loading, setLoading] = useState<boolean>(false);
const [error, setError] = useState<string | null>(null);
const [data, setData] = useState<DataType | null>(null);
```

### Global State - Context API

```typescript
// âœ… CORRECT - Global auth state
const { user, loading, signIn, signOut } = useAuth();

// contexts/AuthContext.tsx
interface AuthContextType {
  user: User | null;
  loading: boolean;
  signIn: (email: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;
}
```

**RULES:**
- âœ… **MUST** use `useState` for local component state
- âœ… **MUST** use Context API for global state (auth, theme)
- âœ… **MUST** define Context interface types
- âŒ **NEVER** use prop drilling for 3+ levels
- âŒ **NEVER** put everything in global state

---

## ğŸ§© COMPONENT PATTERNS

### Props Interface Naming

```typescript
// âœ… CORRECT
interface ImageUploadProps { ... }
interface CorrectionResultProps { ... }

// âŒ WRONG
interface IImageUpload { ... }
interface Props { ... }
```

### Component Structure

```typescript
"use client";

import { useState } from "react";
import { motion } from "framer-motion";

// 1. Props interface
interface ComponentProps {
  title: string;
  onAction: () => void;
}

// 2. Component definition
export default function Component({ title, onAction }: ComponentProps) {
  // 3. State
  const [loading, setLoading] = useState(false);
  
  // 4. Handlers
  const handleClick = async () => {
    setLoading(true);
    try {
      await onAction();
    } catch (error) {
      console.error("Error:", error);
    } finally {
      setLoading(false);
    }
  };
  
  // 5. Render
  return (
    <motion.div {...animationProps}>
      {/* JSX */}
    </motion.div>
  );
}
```

**ORDER:** Props interface â†’ Component â†’ State â†’ Handlers â†’ Render

**RULES:**
- âœ… **MUST** follow this structure order
- âœ… **MUST** use default export for components
- âœ… **MUST** define Props interface before component
- âŒ **NEVER** mix state and handlers with JSX

---

## ğŸ¯ CHILD-FRIENDLY UI REQUIREMENTS

### Design Principles

```tsx
// âœ… Large, touch-friendly buttons (min 44px height)
<button className="py-4 px-12 text-xl font-bold">

// âœ… Use emojis for visual cues
<div className="text-4xl mb-4">ğŸ‰</div>
<h3>Cheer Up! ì˜í–ˆì–´ìš”! ğŸ’ª</h3>

// âœ… Warm, encouraging messages
feedback: "ì™€! ì •ë§ ì˜ ì¼ì–´ìš”! ê³„ì† ì—°ìŠµí•˜ë©´ ë” ì¢‹ì•„ì§ˆ ê±°ì˜ˆìš”! ğŸŒŸ"

// âœ… Bright, warm colors
bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50
```

**RULES:**
- âœ… **MUST** use bright, warm gradient backgrounds
- âœ… **MUST** make buttons large (min-h-[44px] for touch)
- âœ… **MUST** use emojis for visual appeal
- âœ… **MUST** provide encouraging, positive feedback
- âœ… **MUST** use smooth, gentle animations
- âŒ **NEVER** use harsh colors or language
- âŒ **NEVER** criticize mistakes harshly

---

## ğŸš« ABSOLUTE DON'Ts - CRITICAL VIOLATIONS

### 1. Type Safety Violations
```typescript
// âŒ FORBIDDEN
const data: any = ...;
function process(input: any) { ... }
// @ts-ignore
const result = ...;
```

### 2. Security Violations
```typescript
// âŒ FORBIDDEN - Exposing secrets
const apiKey = "sk-abc123..."; // Hardcoded
console.log(process.env.OPENAI_API_KEY); // Logging secrets
```

### 3. Performance Violations
```typescript
// âŒ FORBIDDEN - Memory leaks
useEffect(() => {
  const interval = setInterval(...);
  // Missing cleanup!
}, []);

// âŒ FORBIDDEN - Blocking operations
const data = await fetch(...); // In render body
```

### 4. Styling Violations
```tsx
// âŒ FORBIDDEN - Inline styles
<div style={{ color: 'red', margin: '10px' }}>

// âŒ FORBIDDEN - Inconsistent spacing
<div className="mt-3 mb-5 ml-7 mr-9">
```

### 5. Firebase Violations
```typescript
// âŒ FORBIDDEN - No client check
const auth = getAuth(app); // Might fail on server

// âŒ FORBIDDEN - No error handling
await setDoc(doc(db, "users", id), data); // Might fail
```

---

## âœ… MUST-DO CHECKLIST

Before completing ANY task, verify:

- [ ] All variables and functions have explicit types (NO `any`)
- [ ] `"use client"` is used ONLY when necessary
- [ ] All async operations are wrapped in try-catch-finally
- [ ] Errors are logged with emoji prefixes (âœ…/âŒ/âš ï¸)
- [ ] User-facing errors are in Korean and friendly
- [ ] Tailwind classes follow the correct order
- [ ] Dark mode is supported (`dark:` prefix)
- [ ] Mobile-first responsive design is implemented
- [ ] Firebase operations check `typeof window !== "undefined"`
- [ ] Protected routes are wrapped with `<AuthGuard>`
- [ ] API responses follow the standard format
- [ ] Components use PascalCase file names
- [ ] Props interfaces are named `ComponentNameProps`
- [ ] Animations are subtle and child-friendly
- [ ] Large touch targets for buttons (min 44px)

---

## ğŸ“ LOGGING STANDARDS

```typescript
// âœ… CORRECT - Structured logging with emojis
console.log("=== Request Info ===");
console.log("ğŸ“¸ OCR started...");
console.log("âœ… OCR completed:", text);
console.error("âŒ OCR failed:", error);
console.warn("âš ï¸ Using mock data - API key missing");

// âŒ WRONG - No structure or context
console.log("processing");
console.log(data);
```

**Emoji Guide:**
- ğŸ“¸ - OCR operations
- ğŸ¤– - AI/GPT operations
- ğŸ”¥ - Firebase operations
- âœ… - Success
- âŒ - Error
- âš ï¸ - Warning
- ğŸ’¡ - Info

---

## ğŸ“ AI INTEGRATION GUIDELINES

### OpenAI GPT Prompt Engineering

```typescript
// âœ… CORRECT - Structured prompt with clear instructions
const systemPrompt = `ë‹¹ì‹ ì€ ${age}ì‚´ ì–´ë¦°ì´ë¥¼ ìœ„í•œ ë”°ëœ»í•˜ê³  ì¹œì ˆí•œ ì˜ì–´ ì„ ìƒë‹˜ì…ë‹ˆë‹¤.

[ë‹¹ì‹ ì˜ ì—­í• ]
- ì•„ì´ì˜ ì˜ì–´ ì¼ê¸°ë¥¼ ì²¨ì‚­í•˜ê³  ê²©ë ¤í•˜ëŠ” ì„ ìƒë‹˜
- ì‹¤ìˆ˜ë¥¼ ì§€ì í•˜ê¸°ë³´ë‹¤ëŠ” ì„±ì¥ì„ ì‘ì›í•˜ëŠ” ë”°ëœ»í•œ ë©˜í† 

[ì¤‘ìš”í•œ ì›ì¹™]
1. í•­ìƒ ê¸ì •ì ì´ê³  êµ¬ì²´ì ì¸ ì¹­ì°¬ìœ¼ë¡œ ì‹œì‘
2. êµì •ì€ ë ˆë²¨ì— ë§ê²Œ ì„ íƒ (ë„ˆë¬´ ë§ìœ¼ë©´ ìœ„ì¶•ë¨)
3. ì„¤ëª…ì€ ${age}ì‚´ì´ ì´í•´í•  ìˆ˜ ìˆëŠ” ì‰¬ìš´ ë§ë¡œ

[ì‘ë‹µ í˜•ì‹]
ë°˜ë“œì‹œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”.`;
```

**RULES:**
- âœ… **MUST** provide age-appropriate feedback
- âœ… **MUST** start with positive reinforcement
- âœ… **MUST** limit corrections based on English level
- âœ… **MUST** include Mock fallback when API fails
- âŒ **NEVER** criticize harshly
- âŒ **NEVER** overwhelm with too many corrections

---

## ğŸ—ï¸ PROJECT STRUCTURE RULES

```
app/
â”œâ”€â”€ (auth)/              # Route groups (parentheses)
â”œâ”€â”€ api/                 # API routes (route.ts)
â”œâ”€â”€ components/          # Page-specific components
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts        # ALL types defined here
â”œâ”€â”€ utils/              # Helper functions
â”œâ”€â”€ page.tsx            # Pages
â””â”€â”€ layout.tsx          # Layouts

components/              # Global shared components
contexts/               # React Contexts
lib/                    # External library configs
```

**RULES:**
- âœ… **MUST** define shared types in `app/types/index.ts`
- âœ… **MUST** use route groups `(name)` for organization
- âœ… **MUST** place page-specific components in `app/components/`
- âœ… **MUST** place global components in `components/`
- âŒ **NEVER** create types in random files
- âŒ **NEVER** mix component locations

---

## ğŸ¯ PERFORMANCE OPTIMIZATION

```typescript
// âœ… CORRECT - Image optimization
import Image from "next/image";
<Image src={url} alt="..." width={500} height={300} />

// âœ… CORRECT - Dynamic imports
const HeavyComponent = dynamic(() => import('./Heavy'), {
  loading: () => <LoadingSpinner />,
});

// âœ… CORRECT - Memoization
const expensiveValue = useMemo(() => computeExpensive(data), [data]);
const stableCallback = useCallback(() => handleAction(), [deps]);
```

**RULES:**
- âœ… **MUST** use Next.js `Image` component for images
- âœ… **MUST** use dynamic imports for heavy components
- âœ… **MUST** use `useMemo` for expensive computations
- âœ… **MUST** use `useCallback` for callbacks passed to children
- âŒ **NEVER** import heavy libraries in Server Components
- âŒ **NEVER** perform expensive operations in render

---

## ğŸ“š ACCESSIBILITY (a11y) REQUIREMENTS

```tsx
// âœ… CORRECT - Semantic HTML
<header>
  <nav>
    <main>
      <footer>

// âœ… CORRECT - ARIA labels
<button aria-label="ë©”ë‰´ ì—´ê¸°" aria-expanded={isOpen}>
  <MenuIcon />
</button>

// âœ… CORRECT - Alt text
<img src="/logo.png" alt="Company logo" />
<Image src={preview} alt="Uploaded diary photo preview" />

// âœ… CORRECT - Focus styles
focus:ring-2 focus:ring-blue-500 focus:outline-none
```

**RULES:**
- âœ… **MUST** use semantic HTML tags
- âœ… **MUST** provide ARIA labels for icon-only buttons
- âœ… **MUST** provide alt text for all images
- âœ… **MUST** ensure keyboard navigation works
- âœ… **MUST** provide visible focus indicators
- âœ… **MUST** maintain color contrast ratios (WCAG AA)
- âŒ **NEVER** use div/span for interactive elements
- âŒ **NEVER** remove focus outlines without replacement

---

## ğŸ”„ DATA FLOW PATTERNS

### Form Submission
```
User Input 
  â†’ Client Validation 
    â†’ API Route Call 
      â†’ Server Validation 
        â†’ Firestore Save 
          â†’ LocalStorage Backup 
            â†’ Success Feedback
```

### Authentication Flow
```
Login Attempt 
  â†’ Firebase Auth 
    â†’ AuthContext Update 
      â†’ AuthGuard Check 
        â†’ Protected Page Access
```

**RULES:**
- âœ… **MUST** validate on both client and server
- âœ… **MUST** backup critical data to localStorage
- âœ… **MUST** provide immediate user feedback
- âŒ **NEVER** skip validation
- âŒ **NEVER** trust client-side data

---

## ğŸ’¡ DECISION FLOWCHART

### When to use `"use client"`?
```
Does component need:
â”œâ”€ useState/useReducer? â†’ YES â†’ "use client"
â”œâ”€ useEffect? â†’ YES â†’ "use client"
â”œâ”€ Event handlers? â†’ YES â†’ "use client"
â”œâ”€ Browser APIs? â†’ YES â†’ "use client"
â”œâ”€ Framer Motion? â†’ YES â†’ "use client"
â””â”€ None of above? â†’ NO â†’ Server Component
```

### Where to define types?
```
Is type used in:
â”œâ”€ Multiple files? â†’ YES â†’ app/types/index.ts
â”œâ”€ Single file? â†’ YES â†’ Define in same file
â””â”€ Need to export? â†’ YES â†’ app/types/index.ts
```

### Where to place components?
```
Is component used in:
â”œâ”€ Multiple pages? â†’ YES â†’ components/
â”œâ”€ Single page/feature? â†’ YES â†’ app/components/
â””â”€ Specific route? â†’ YES â†’ app/[route]/components/
```

---

## ğŸ¬ EXAMPLE: PERFECT COMPONENT

```typescript
"use client";

import { useState, useCallback } from "react";
import { motion } from "framer-motion";

// 1. Props interface (exported for reuse)
export interface DiaryUploadProps {
  onUploadComplete: (result: CorrectionResult) => void;
  maxFileSize?: number;
}

// 2. Component with explicit typing
export default function DiaryUpload({ 
  onUploadComplete,
  maxFileSize = 5 * 1024 * 1024 // 5MB
}: DiaryUploadProps) {
  // 3. State with explicit types
  const [file, setFile] = useState<File | null>(null);
  const [loading, setLoading] = useState<boolean>(false);
  const [error, setError] = useState<string | null>(null);

  // 4. Memoized callback
  const handleUpload = useCallback(async () => {
    if (!file) {
      setError("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
      return;
    }

    setLoading(true);
    setError(null);

    try {
      console.log("ğŸ“¸ Starting upload...");
      
      const formData = new FormData();
      formData.append("image", file);

      const response = await fetch("/api/upload", {
        method: "POST",
        body: formData,
      });

      if (!response.ok) {
        throw new Error("Upload failed");
      }

      const result = await response.json();
      
      if (result.success) {
        console.log("âœ… Upload completed");
        onUploadComplete(result.data);
      } else {
        throw new Error(result.error || "Unknown error");
      }
    } catch (err: unknown) {
      const error = err as Error;
      console.error("âŒ Upload error:", error);
      setError(error.message || "ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");
    } finally {
      setLoading(false);
    }
  }, [file, onUploadComplete]);

  // 5. Render with proper styling and animation
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.5 }}
      className="w-full max-w-2xl p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-xl"
    >
      <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-4">
        ì˜ì–´ ì¼ê¸° ì—…ë¡œë“œ
      </h2>

      <input
        type="file"
        accept="image/*"
        onChange={(e) => setFile(e.target.files?.[0] || null)}
        className="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
      />

      {error && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          className="mt-4 bg-red-100 dark:bg-red-900/30 border border-red-400 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg"
        >
          {error}
        </motion.div>
      )}

      <button
        onClick={handleUpload}
        disabled={!file || loading}
        className={`
          mt-6 w-full
          bg-gradient-to-r from-blue-500 to-purple-500 
          text-white font-bold 
          py-4 px-8 
          rounded-lg shadow-lg 
          transition-all
          ${!file || loading 
            ? "opacity-50 cursor-not-allowed" 
            : "hover:scale-105 hover:shadow-xl"
          }
        `}
      >
        {loading ? "ì—…ë¡œë“œ ì¤‘..." : "ì—…ë¡œë“œí•˜ê¸° ğŸš€"}
      </button>
    </motion.div>
  );
}
```

---

## ğŸ“ REMEMBER: THE 3 COMMANDMENTS

1. **TYPE EVERYTHING** - Zero tolerance for `any`
2. **HANDLE ALL ERRORS** - No silent failures
3. **BE CHILD-FRIENDLY** - Warm, encouraging, accessible

---

**When in doubt, ASK rather than GUESS. Quality over speed. User experience over developer convenience.**

---

*Last Updated: 2025-12-16*  
*Project: English Diary AI Correction for Children*
